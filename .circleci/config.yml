version: 2.1

jobs:
  build:
    docker:
      - image: cimg/python:3.12.1

    steps:
      - checkout

      # Install Ansible and Meraki SDK
      - run:
          name: Install Ansible and Meraki SDK
          command: |
            sudo apt-get update
            sudo apt-get install -y ansible
            pip install meraki
            # Install Meraki Ansible collection
      - run:
          name: Install Meraki Ansible collection
          command: ansible-galaxy collection install cisco.meraki
      # Run Ansible playbook
      - run:
          name: Run Ansible playbook
          command: ansible-playbook -i "localhost," -c local show_org/org.yml
          environment:
            MERAKI_API_KEY: $MERAKI_API_KEY  # Pass the Meraki API key as an environment variable
            ORG_ID: $ORG_ID
      # - run:
      #     name: Run Ansible playbook
      #     command: ansible-playbook -i "localhost," -c local show_org/org.yml
      #     environment:
      #       MERAKI_API_KEY: $MERAKI_API_KEY  # Pass the Meraki API key as an environment variable

workflows:
  version: 2
  build:
    jobs:
      - build:
          context: meraki_stuff  # Use the 'meraki_stuff' context
