version: 2.1

jobs:
  build:
    docker:
      - image: cimg/python:3.12.1

    steps:
      - checkout

      # Install Ansible and Meraki SDK
      - run:
          name: Install Ansible and Meraki SDK
          command: |
            sudo apt-get update
            sudo apt-get install -y ansible
            pip install meraki -t ~/.ansible/collections/ansible_collections/cisco/meraki

      # Run Ansible playbook
      - run:
          name: Run Ansible playbook
          command: ansible-playbook -i "localhost," -c local show_org/org.yml
          environment:
            MERAKI_API_KEY: <<pipeline.contexts.meraki_stuff.MERAKI_API_KEY>>  # Reference the Meraki API key from the context
            ANSIBLE_COLLECTIONS_PATH: ~/.ansible/collections
            ORG_ID: <<pipeline.contexts.meraki_stuff.ORG_ID>>  # Reference the ORG_ID from the context
